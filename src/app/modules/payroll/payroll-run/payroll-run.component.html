<div class="flex flex-col flex-auto min-w-0">
    <!-- Main -->
    <div class="flex-auto">
        <!-- Header -->

        <div class="bg-card h-full">
            <div class="flex-auto p-2 sm:p-4">

                <mat-card-title>
                    <app-card-title title="Payroll Run" [sub]="true" [back]="true" [prev]="true" [next]="true" (prevTap)="stepper.previous()" (nextTap)="stepper.next()" (backTap)="forListview()" (submitTap)="saveDetails()"></app-card-title>
                </mat-card-title>

                <div class="flex flex-wrap- gap-2 place-content-start">
                    <p><strong>{{detailForm.value.payrollCode}}</strong>_
                        {{detailForm.value.description ? detailForm.value.description.split('_')[1]?.trim() : 'N/A'}}
                      </p>
                </div>

                <mat-stepper #stepper  [selectedIndex]="0" (selectionChange)="onStepperSelectionChange($event)" >

                    <!-- ======================================================== DETAILS ============================================================================= -->

                    <mat-step [stepControl]="detailForm" [completed]="detailsSaved">
                        <form [formGroup]="detailForm">
                            <ng-template matStepLabel>Details</ng-template>
                            <mat-card>

                                <div class="grid grid-cols-12 gap-2 h-full">
                                    <div class="col-span-9">
                                        <div class="grid grid-cols-7 gap-2">

                                            <mat-form-field class="field" appearance="outline">
                                                <mat-label class="label-font-size">Payroll Code</mat-label>
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <input readonly autocomplete="off" matInput type="text" formControlName="payrollCode">
                                            </mat-form-field>

                                            <div class="field">
                                                <app-dropdown [control]="detailForm.get('payoutTypeID')" [options]="dropdownOptions.payoutTypeDef" [label]="'Payroll Type'" [icon]="'mat_outline:info'" (selected)="reset()" [type]="74"> </app-dropdown>
                                            </div>

                                            <mat-form-field class="field" appearance="outline">
                                                <mat-label class="label-font-size">Payroll Cutoff</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [placeholder]="'Payroll Cutoff'" formControlName="categoryPayroll" (selectionChange)="typeHandler($event)">
                                                    <mat-option *ngFor="let item of payrollCutoff"
                                                        [value]="item.cutoffHeaderId">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="detailForm.value.payoutTypeID === 12723" class="field" appearance="outline">
                                                <mat-label class="label-font-size">As of Date </mat-label>
                                                <input matInput formControlName="asofdate" [matDatepicker]="ad" readonly
                                                    [placeholder]="'MM/DD/YYYY'">
                                                <mat-datepicker-toggle matSuffix [for]="ad"></mat-datepicker-toggle>
                                                <mat-datepicker #ad></mat-datepicker>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722" class="field" appearance="outline">
                                                <mat-label class="label-font-size">Year</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="year" (selectionChange)="cutoffSelectionHandler()">
                                                    <mat-option *ngFor="let item of year" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <div class="field" *ngIf="this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722">
                                                <app-dropdown [control]="detailForm.get('month')"  [options]="dropdownOptions.monthlydef" [icon]="'mat_outline:info'" [type]="54" (selected)="cutoffSelectionHandler();displayChange()"></app-dropdown>
                                            </div>

                                            <mat-form-field *ngIf="this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722" class="field" appearance="outline">
                                                <mat-label class="label-font-size">Cut Off</mat-label>
                                                <mat-select [placeholder]="'Cut Off'" formControlName="cutoffID" (selectionChange)="cutoffHandler($event,true); payrollDateDisp()">
                                                    <mat-option *ngFor="let item of cutoff"
                                                    [value]="item.id">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <div class="field" *ngIf="detailForm.value.payoutTypeID === 12720">
                                                <app-dropdown [control]="detailForm.get('finalStatus')" [options]="dropdownOptions.finalPayStatDef" [multiple]="true" [all]="true" [value]="this.dF?.finalStatus" [label]="'Final Pay Status'" [icon]="'mat_outline:info'" [type]="145"></app-dropdown>
                                            </div>

                                            <mat-form-field class="field" appearance="outline">
                                                <mat-label class="label-font-size">Payout Date</mat-label>
                                                <input matInput formControlName="payoutDateDisplay" (dateChange)="displayChange()" [matDatepicker]="db" readonly
                                                    [placeholder]="'yyyy-MM-dd'">
                                                <mat-datepicker-toggle matSuffix [for]="db"></mat-datepicker-toggle>
                                                <mat-datepicker #db></mat-datepicker>
                                            </mat-form-field>

                                        </div>

                                        <div class="grid grid-cols-7 gap-2">
                                            <mat-form-field class="w-full h-10 text-md" appearance="outline">
                                                <mat-label class="label-font-size">Sub Company</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [multiple]="true" [placeholder]="'Sub Company'" formControlName="subCompany" (selectionChange)="branchHandler()">
                                                    <mat-option *ngIf="subCompany?.length > 0" [value]="0" (click)="selectAllHandler(allSubCompany,'subCompany', subCompany)"
                                                        #allSubCompany>Select All</mat-option>
                                                    <mat-option *ngFor="let item of subCompany" [value]="item.dropdownID">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="w-full h-10 text-md" appearance="outline">
                                                <mat-label class="label-font-size">Branch</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [multiple]="true" [placeholder]="'Branch'" formControlName="branch">
                                                    <mat-option *ngIf="branch?.length > 0" [value]="0" (click)="selectAllHandler(allBranch,'branch', branch)"
                                                        #allBranch>Select
                                                        All</mat-option>
                                                    <mat-option *ngFor="let item of branch" [value]="item.dropdownID">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="w-full h-10 text-md" appearance="outline">
                                                <mat-label class="label-font-size">Employee Category</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [multiple]="true" [placeholder]="'Employee Category'" formControlName="category">
                                                    <mat-option *ngIf="category?.length > 0" [value]="0" (click)="selectAllHandler(allCategory,'category', category)" #allCategory>Select
                                                        All</mat-option>
                                                    <mat-option *ngFor="let item of category" [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="w-full h-10 text-md" appearance="outline">
                                                <mat-label class="label-font-size">Department</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [multiple]="true" [placeholder]="'Department'" formControlName="department">
                                                    <mat-option *ngIf="department?.length > 0" [value]="0" (click)="selectAllHandler(allDepartment,'department', department)"
                                                        #allDepartment>Select All</mat-option>
                                                    <mat-option *ngFor="let item of department" [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="w-full h-10 text-md" appearance="outline">
                                                <mat-label class="label-font-size">Confidential</mat-label>
                                                <mat-icon class="icon icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [multiple]="true" [placeholder]="'Confidential'" formControlName="confidential">
                                                    <mat-option *ngIf="confidential?.length > 0" [value]="0" (click)="selectAllHandler(allConfidential,'confidential', confidential)"
                                                        #allConfidential>Select All</mat-option>
                                                    <mat-option *ngFor="let item of confidential" [value]="item.dropdownID" (click)="employeeChild()">{{item.description}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="field" appearance="outline">
                                                <mat-label class="label-font-size">Employee</mat-label>
                                                <mat-icon class="icon icon-size-5 mr-2" matPrefix [svgIcon]="'mat_outline:info'"></mat-icon>
                                                <mat-select formControlName="employee" [multiple]="multiple" [placeholder]="'Employee'" (infiniteScroll)="getNextBatchss()" msInfiniteScroll [complete]="complete" [threshold]="'20%'" (openedChange)="onSelectOpen($event)">
                                                    <mat-option class="select">
                                                        <input type="input" (click)="$event.stopPropagation()" class="border-2 pr-4 pl-4 search-field" [placeholder]="'Find Employee ' + ' ..'" [formControl]="inputChange">
                                                  </mat-option>
                                                  <mat-option  *ngIf="employee?.length > 0"   [value]="0" (click)="selectAllHandler(allEmployee,'employee', employee)" #allEmployee >Select All</mat-option>
                                                  <mat-option *ngFor="let option of employee" [id]="option.encryptID" [value]="option.dropdownID" (click)="selectedEvent(option.dropdownID)">
                                                    {{option.description}}
                                                  </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="field" appearance="outline">
                                                <mat-label class="label-font-size">Annualize</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="annualize">
                                                    <mat-option *ngFor="let item of annual" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                    </div>
                                    <div class="col-span-3">
                                        <textarea *ngIf="this.detailForm.value.payoutTypeID === 12719 || this.detailForm.value.payoutTypeID === 12722" style="border-width: 1px; margin-top: 2px; border-radius: 3px; "  class="text-error area" name="questionText" cols="35" rows="8" placeholder="Description"
                                        formControlName="description" required></textarea>

                                        <div class="text-error area mb-2.5" *ngIf="this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723"></div>

                                        <div class="col-span-2">
                                            <button class="mt-0.5 w-10 mr-1"
                                                *ngIf="this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12720 ||
                                                this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723 ||
                                                this.detailForm.value.payoutTypeID === 12719 && this.weeklyDisplay"
                                                (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                                                <mat-label>&nbsp;</mat-label>
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                            </button>

                                            <button *ngIf="this.detailForm.value.payoutTypeID == 12722 ||
                                                this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 ||
                                                this.detailForm.value.payoutTypeID === 12723 || this.detailForm.value.payoutTypeID === 12719"
                                                (click)="dialogSetupCurrency()" mat-flat-button color="primary" class="mt-0.5 text-md" matTooltip="Setup Currency"> Setup Currency
                                            </button>
                                        </div>
                                        <!-- <div class="grid grid-cols-2 gap-2">

                                            <button class="mt-0.5 w-10" *ngIf="this.detailForm.value.payoutTypeID == 12722 || this.detailForm.value.payoutTypeID === 12720 || this.detailForm.value.payoutTypeID === 12721 || this.detailForm.value.payoutTypeID === 12723" (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                                                <mat-label>&nbsp;</mat-label>
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                            </button>

                                            <button (click)="dialogSetupCurrency()" mat-flat-button color="primary" class="mt-[3px] text-md" matTooltip="Setup Currency"> Setup Currency
                                            </button>

                                        </div> -->
                                        <!-- <div class="grid grid-rows-4 grid-flow-col gap-4">
                                            <div class="row-start-3 row-span-2">
                                                <button *ngIf="this.detailForm.value.payoutTypeID === 12720" (click)="finalList()" mat-flat-button [color]="'primary'"  matTooltip="Search">
                                                    <mat-label>&nbsp;</mat-label>
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                </button>
                                            </div>
                                        </div> -->
                                    </div>
                                </div>
                                <div *ngIf="this.detailForm.value.payoutTypeID == 12722 && this.specialDetailSource?.length > 0   ||
                                            this.detailForm.value.payoutTypeID === 12720 && this.employeeDetailSource?.length > 0 ||
                                            this.detailForm.value.payoutTypeID === 12723 && this.thirteenmonthDetailSource?.length > 0 ||
                                            this.detailForm.value.payoutTypeID === 12721 && this.maternityDetailSource?.length > 0" class="border-t-2 pt-2 mt-2">
                                    <div class="flex flex-wrap gap-2">
                                        <div class="flex-grow"></div>
                                        <mat-form-field class="text-md h-5" appearance="outline">
                                            <mat-label class="label-font-size">Employee Code</mat-label>
                                            <input matInput [placeholder]="'Employee Code'" formControlName="employeeCode">
                                        </mat-form-field>
                                        <mat-form-field class="text-md h-5" appearance="outline">
                                            <mat-label class="label-font-size">Employee Name</mat-label>
                                            <input matInput [placeholder]="'Employee Name'" formControlName="employeeName">
                                        </mat-form-field>
                                        <button (click)="searchParams(this.detailForm,'details')" class="mb-5" mat-flat-button [color]="'primary'">
                                            <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                            <span class="hidden sm:inline-block ml-2">Search</span>
                                        </button>
                                        <button class="mb-5" mat-flat-button color="primary">
                                            <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                        </button>
                                    </div>
                                </div>


                                <!-- ------------ Details Table ---------- -->

                                <div *ngIf="this.detailForm.value.payoutTypeID === 12719 && !this.weeklyDisplay" class="mt-10 mb-10 h-[55vh]">
                                    <app-generate [datasource]="detailsSource" [cols]="detailsColumns" [hideCols]="isHide" [details]="isDetails" [empStatus]="isStatus"></app-generate>
                                </div>

                                <div *ngIf="this.detailForm.value.payoutTypeID === 12719 && this.weeklyDisplay && this.regularWeeklySource.length > 0" class="mt-10 mb-10 h-[55vh]">
                                    <app-generate [datasource]="regularWeeklySource"
                                                      (headersChecked)="headerList = $event"
                                                      [headersfromParent]="headerList"
                                                      (selectedList)="selected = $event"
                                                      (selected)="detailCheck = $event;payregTable()"
                                                      (excludedList)="excluded = $event"
                                                      (tablefilter)="nextPage($event,'details','',false)"
                                                      [checkboxLabel]="false"
                                                      [totalRows]="totalRowsDetail"
                                                      [cols]="regularWeeklyColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                        </app-generate>
                                </div>

                                <div *ngIf="this.employeeDetailSource.length > 0" class="mb-10 h-[55vh]">
                                        <app-generate [datasource]="employeeDetailSource"
                                                      (headersChecked)="headerList = $event"
                                                      [headersfromParent]="headerList"
                                                      (selected)="detailCheck = $event;payregTable()"
                                                      (excludedList)="excluded = $event"
                                                      (selectedList)="selected = $event"
                                                      (tablefilter)="nextPage($event,'details','',false)"
                                                      [checkboxLabel]="false"
                                                      [totalRows]="totalRowsDetail"
                                                      [cols]="employeeDetailColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                        </app-generate>
                                </div>

                                <div *ngIf="this.specialDetailSource.length > 0" class="mb-10 h-[55vh]">
                                        <app-generate [datasource]="specialDetailSource"
                                                      (headersChecked)="headerList = $event"
                                                      [headersfromParent]="headerList"
                                                      (selectedList)="selected = $event"
                                                      (selected)="detailCheck = $event;payregTable()"
                                                      (excludedList)="excluded = $event"
                                                      (tablefilter)="nextPage($event,'details','',false)"
                                                      [checkboxLabel]="false"
                                                      [totalRows]="totalRowsDetail"
                                                      [cols]="specialDetailColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                                      <!-- (headersChecked)="headerList = $event" -->
                                        </app-generate>
                                </div>

                                <div *ngIf="this.maternityDetailSource.length > 0" class="mb-10 h-[55vh]">
                                        <app-generate [datasource]="maternityDetailSource"
                                                      (headersChecked)="headerList = $event"
                                                      [headersfromParent]="headerList"
                                                      (selectedList)="selected = $event"
                                                      (selected)="detailCheck = $event;payregTable()"
                                                      (excludedList)="excluded = $event"
                                                      (tablefilter)="nextPage($event,'details','',false)"
                                                      [checkboxLabel]="false"
                                                      [totalRows]="totalRowsDetail"
                                                      [cols]="maternityDetailColumns"
                                                      [details]="false"
                                                      [hideCols]="true">
                                        </app-generate>
                                </div>

                                <div *ngIf="this.thirteenmonthDetailSource.length > 0" class="mb-10 h-[55vh]">
                                    <app-generate [datasource]="thirteenmonthDetailSource"
                                                  (headersChecked)="headerList = $event"
                                                  [headersfromParent]="headerList"
                                                  (selectedList)="selected = $event"
                                                  (selected)="detailCheck = $event;payregTable()"
                                                  (excludedList)="excluded = $event"
                                                  (tablefilter)="nextPage($event,'details','',false)"
                                                  [checkboxLabel]="false"
                                                  [totalRows]="totalRowsDetail"
                                                  [cols]="thirteenmonthDetailColumns"
                                                  [details]="false"
                                                  [hideCols]="true">
                                    </app-generate>
                            </div>

                            </mat-card>
                        </form>
                    </mat-step>

                    <!-- ===================================================== TIMEKEEPING =========================================================== -->

                    <mat-step *ngIf="!stepperHide" [stepControl]="timekeepingForm">
                        <ng-template matStepLabel>Timekeeping</ng-template>
                        <form [formGroup]="timekeepingForm">
                            <mat-card>

                                <!-- ============== UPLOAD FILE ============= -->

                                <div class="grid grid-cols-2 gap-1">
                                    <div class="border-2 p-4 rounded-sm">

                                        <!-- ============= Timekeeping Type ============= -->

                                        <div class="flex flex-wrap gap-2 h-12">
                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size">Timekeeping Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('tkt')" formControlName="timekeepingType" (ngModelChange)="tkSystemGenDD(false)">
                                                    <mat-option *ngFor="let item of tk" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="timekeepingForm.value.timekeepingType === 12686" appearance="outline">
                                                <mat-label class="label-font-size">Timekeeping Attendance</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="timekeepingAttendance">
                                                    <mat-option *ngFor="let item of code" [value]="item.dropdownID">{{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field  *ngIf="timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12703" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #tkFile (change)="uploadFileTk($event,'tkfile','tkt',false)"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="tkfile" (change)="uploadFileTk($event,'tkfile','tkt',false)" formControlName="uploadFile"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button
                                                    color="primary" (click)="tkFile.click()" [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>

                                            <button  *ngIf="timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12703" (click)="download(timekeepingForm.value.timekeepingType === 12703 ? 'Timekeeping Summary Upload template':'Timekeeping Detailed Upload Template')" class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'primary'" matTooltip="Download">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                            </button>
                                            <button *ngIf="timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686"
                                                class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'warn'" (click)="Delete('tkt')" matTooltip="Delete">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Delete</span> -->
                                            </button>
                                            <button *ngIf="(timekeepingForm.value.timekeepingType === 12686 || timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.transactionType === 1) && this.showCancel"
                                            class="p-3 px-1 sm:px-4 mt-0.5" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                            </button>
                                            <button *ngIf="timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686"
                                                class="p-3 px-1 sm:px-4 w-10 mt-0.5" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('first','tk')" [disabled]="buttonDisabled" matTooltip="Save">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'mat_outline:save'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                            </button>

                                        </div>

                                        <!-- ============= Upload table ============= -->

                                        <div *ngIf="timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704 || timekeepingForm.value.timekeepingType === 12686"  class="grid grid-cols-2">
                                            <div *ngIf="timekeepingForm.value.timekeepingType === 12703">
                                             <p class="text-md pl-3"><strong>Summary Saved files</strong></p>
                                             <mat-card class="scroll-container mat-elevation-z0">
                                                 <app-upload #tkTable
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableT = $event"
                                                        [datasource]="TKTableSource"
                                                        (deleted)="tkTableDelete = $event"
                                                        [del]="tkTableDelete"
                                                        (selected)="checkTableT = $event;checkersTk('utkT')"
                                                        [isLoadDone]="true" [isSaveDone]="true">
                                                 </app-upload>
                                             </mat-card>
                                            </div>
                                            <div *ngIf="timekeepingForm.value.timekeepingType === 12704">
                                                <p class="text-md pl-3"><strong>Detail Saved files</strong></p>
                                                <mat-card class="scroll-container mat-elevation-z0">
                                                    <app-upload #tkTable
                                                           [checkbox]="deleteShow"
                                                           [cancel]="hideCancel"
                                                           [viewer]="view"
                                                           (selectDel)="delTableT = $event"
                                                           [datasource]="TKTableSource"
                                                           (deleted)="tkTableDelete = $event"
                                                           [del]="tkTableDelete"
                                                           (selected)="checkTableT = $event;checkersTk('utkT')"
                                                           [isLoadDone]="true" [isSaveDone]="true">
                                                    </app-upload>
                                                </mat-card>
                                               </div>
                                            <div *ngIf="timekeepingForm.value.timekeepingType === 12686">
                                             <p class="text-md pl-3"><strong>Sys-Gen Saved files</strong></p>
                                             <mat-card *ngIf="timekeepingForm.value.timekeepingType === 12686" class="scroll-container mat-elevation-z0">
                                                <app-upload #tkTable
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableS = $event"
                                                        [datasource]="SysTableSource"
                                                        (deleted)="sysTableDelete = $event"
                                                        [del]="sysTableDelete"
                                                        (selected)="checkTableS = $event;checkersTk('system')"
                                                        [isLoadDone]="true"
                                                        [isSaveDone]="true">
                                                </app-upload>
                                            </mat-card>
                                            </div>
                                            <div class="border-l-4">
                                             <br>

                                            <mat-card *ngIf="this.TkSource.length > 0" class="scroll-container mat-elevation-z0">
                                                <app-upload
                                                    [checkbox]="deleteShow"
                                                    [cancel]="hideCancel"
                                                    [viewer]="view"
                                                    (selectDel)="delTableTC = $event"
                                                    [id]="tkfile"
                                                    [datasource]="TkSource"
                                                    (deleted)="isDelete = $event"
                                                    (selected)="checkedListTk = $event;checkersTk('tkt')"
                                                    [del]="isDelete"
                                                    [isLoadDone]="loading"
                                                    [isSaveDone]="saving" >
                                                </app-upload>
                                            </mat-card>
                                            </div>
                                         </div>

                                    </div>

                                    <div class="border-2 p-4 rounded-sm">

                                        <!-- ============= Timekeeping Adjustment ============= -->

                                        <div class="flex flex-wrap gap-2 h-12">

                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size">Timekeeping Adjustment</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('tkTAB')" formControlName="timekeepingAdjustment" (ngModelChange)="tkSystemGenDD(true)">
                                                    <mat-option *ngFor="let item of tk" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12703" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #tkABFile (change)="uploadFileTk($event,'tkABfile','tka',true)"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="tkABfile" (change)="uploadFileTk($event,'tkABfile','tka',true)" formControlName="uploadFile2"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button
                                                    color="primary" (click)="tkABFile.click()" [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="timekeepingForm.value.timekeepingAdjustment === 12686" appearance="outline">
                                                <mat-label class="label-font-size">Timekeeping Adjustment
                                                    Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="timekeepingCode">
                                                    <mat-option *ngFor="let item of code" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <button *ngIf="timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12703"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download(timekeepingForm.value.timekeepingAdjustment === 12703 ? 'Timekeeping Summary Upload template':'Timekeeping Detailed Upload Template')">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                            </button>

                                            <button *ngIf="timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" matTooltip="Delete" (click)="Delete('tka')">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Delete</span> -->
                                            </button>

                                            <button *ngIf="(timekeepingForm.value.timekeepingAdjustment === 12686 || timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.transactionType === 12704) && this.showCancel"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                            </button>

                                            <button *ngIf="timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686 "
                                            class="p-3 px-1 sm:px-4 w-10" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('second','tka')" [disabled]="buttonDisabled" matTooltip="Save">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'mat_outline:save'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                            </button>

                                        </div>

                                        <!-- ============= Upload table ============= -->

                                        <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704 || timekeepingForm.value.timekeepingAdjustment === 12686"  class="grid grid-cols-2">
                                            <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12703">
                                                <p class="text-md pl-3"><strong>Summary Saved files</strong></p>
                                                <mat-card class="scroll-container mat-elevation-z0">
                                                   <app-upload #tkTable
                                                       [checkbox]="deleteShow"
                                                       [cancel]="hideCancel"
                                                       [viewer]="view"
                                                       (selectDel)="delTableAB = $event"
                                                       [datasource]="TKATableSource"
                                                       (deleted)="tkaTableDelete = $event"
                                                       [del]="tkaTableDelete"
                                                       (selected)="checkTableTAB = $event;checkersTk('utkA')"
                                                       [isLoadDone]="true" [isSaveDone]="true">
                                                   </app-upload>
                                                </mat-card>
                                            </div>
                                            <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12704">
                                                <p class="text-md pl-3"><strong>Detail Saved files</strong></p>
                                                <mat-card class="scroll-container mat-elevation-z0">
                                                    <app-upload #tkTable
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableAB = $event"
                                                        [datasource]="TKATableSource"
                                                        (deleted)="tkaTableDelete = $event"
                                                        [del]="tkaTableDelete"
                                                        (selected)="checkTableTAB = $event;checkersTk('utkA')"
                                                        [isLoadDone]="true" [isSaveDone]="true">
                                                    </app-upload>
                                                </mat-card>
                                               </div>
                                            <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12686">
                                             <p class="text-md pl-3"><strong>Sys-Gen Saved files</strong></p>
                                             <mat-card *ngIf="timekeepingForm.value.timekeepingType === 12686" class="scroll-container mat-elevation-z0">
                                                <app-upload #tkTable
                                                    [checkbox]="deleteShow"
                                                    [cancel]="hideCancel"
                                                    [viewer]="view"
                                                    (selectDel)="delTableSAB = $event"
                                                    [datasource]="SysATableSource"
                                                    (deleted)="sysATableDelete = $event"
                                                    [del]="sysATableDelete"
                                                    (selected)="checkTableS = $event;checkersTk('systemAB')"
                                                    [isLoadDone]="true" [isSaveDone]="true">
                                                </app-upload>
                                            </mat-card>
                                            </div>
                                            <div class="border-l-4">
                                             <br>

                                            <mat-card *ngIf="this.TkABSource.length > 0" class="mat-elevation-z0">
                                                <app-upload [id]="tkfile2"
                                                    [checkbox]="deleteShow"
                                                    [cancel]="hideCancel"
                                                    [viewer]="view"
                                                    (selectDel)="delTableABC = $event"
                                                    [datasource]="TkABSource"
                                                    (deleted)="isDelete2 = $event"
                                                    (selected)="checkedListTkAB = $event;checkersTk('tka')"
                                                    [del]="isDelete2"
                                                    [isLoadDone]="loading"
                                                    [isSaveDone]="saving">
                                                </app-upload>
                                            </mat-card>
                                            </div>
                                         </div>
                                    </div>
                                </div>

                                <div class="mt-5">

                                    <!-- ============= Filter Fields ============= -->

                                    <div class="flex flex-wrap place-content-between">

                                        <div class="flex flex-wrap gap-2 ">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Timekeeping </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListTk.length == 0" (selectionChange)="checkersTk('tkt'); switchTk('tkt')" formControlName="timekeeping">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Timekeeping Adjustment </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListTkAB.length == 0 || this.timekeepingForm.value.timekeepingAdjustment === 12703" (selectionChange)="checkersTk('tka'); switchTk('tka')" formControlName="attendance">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                        <div class="flex flex-wrap gap-2">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input formControlName="search" matInput placeholder="Search...">
                                                <!-- <mat-icon matSuffix>search</mat-icon> -->
                                            </mat-form-field>

                                            <button (click)="searchParams(this.timekeepingForm,'details')" class="mb-5" mat-flat-button [color]="'primary'">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                <span class="hidden sm:inline-block ml-2">Search</span>
                                            </button>

                                            <button class="mb-5" mat-flat-button color="primary">
                                                <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                            </button>
                                        </div>

                                    </div>

                                    <!-- ============= TK table ============= -->

                                    <div *ngIf="timekeepingForm.value.timekeepingType === 12704 && this.timekeepingSource.length > 0 && this.checkedListTk.length > 0 || timekeepingForm.value.timekeepingType === 12703 && this.timekeepingSource.length > 0 && this.checkedListTk.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>TK Current Upload File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="true"
                                                                   [datasource]="timekeepingSource"
                                                                   (tablefilter)="nextPage($event,'tkt','',false)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT"></app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="(timekeepingForm.value.timekeepingType === 12703 || timekeepingForm.value.timekeepingType === 12704) && this.tkUpload.length > 0 && this.checkTableT.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>TK Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="false"
                                                                   [datasource]="tkUpload"
                                                                   (tablefilter)="nextPage($event,'utkT','',true)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT">
                                            </app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="timekeepingForm.value.timekeepingType === 12686 && this.sysUpload.length > 0 && this.checkTableS.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Sys-Gen Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="false"
                                                                   [datasource]="sysUpload"
                                                                   (tablefilter)="nextPage($event,'system','',true)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT">
                                            </app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12704 && this.timekeepingABSource.length > 0 && this.checkedListTkAB.length > 0 || timekeepingForm.value.timekeepingAdjustment === 12703 && this.timekeepingABSource.length > 0 && this.checkedListTkAB.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>TK ADJ Current Upload File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="false"
                                                                   [datasource]="timekeepingABSource"
                                                                   (tablefilter)="nextPage($event,'tka','',false)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT">
                                            </app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="(timekeepingForm.value.timekeepingAdjustment === 12703 || timekeepingForm.value.timekeepingAdjustment === 12704) && this.timekeepingABSource.length > 0 && this.checkTableTAB.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>TK ADJ Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="true"
                                                                   [datasource]="timekeepingABSource"
                                                                   (tablefilter)="nextPage($event,'utkA','',false)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT">
                                            </app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="timekeepingForm.value.timekeepingAdjustment === 12686 && this.sysUpload.length > 0 && this.checkTableS.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Sys-Gen Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-timekeeping-table [action]="false"
                                                                   [datasource]="sysAUpload"
                                                                   (tablefilter)="nextPage($event,'systemAB','',true)"
                                                                   [totalRows]="totalRows"
                                                                   [searchVal]="searchTermTk"
                                                                   [error]="columnHideT">
                                            </app-timekeeping-table>
                                        </mat-card>
                                    </div>

                                </div>

                                <br><br><br>

                            </mat-card>
                        </form>
                    </mat-step>

                    <!-- ===================================================== EARNINGS =========================================================== -->

                    <mat-step *ngIf="!stepperHide" [stepControl]="earningForm">
                        <form [formGroup]="earningForm">
                            <ng-template matStepLabel>Earnings</ng-template>

                            <mat-card class="h-full">

                                        <div class="grid grid-cols-10">
                                            <mat-form-field appearance="outline" class="h-12">
                                                <mat-label class="label-font-size">Transaction Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                                    <mat-option *ngFor="let item of transac" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                <div *ngIf="earningForm.value.transactionType == 1" class="relative h-[50vh]">
                                    <app-datatable
                                                   [tagType]="[{id:[],type:-4}]"
                                                   [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                                   [hideFilter]="true"
                                                   [path]="'earnings-view'"
                                                   [search_btn] = true
                                                   [delete_btn] = true
                                                   [reload_btn] = true
                                                   >
                                    </app-datatable>
                                </div>
                                <!-- ================ For Add Transaction Type =================== -->

                                <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                                    <!-- ================ Field for Earning =================== -->
                                    <div *ngIf="earningForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                        <div class="flex flex-wrap gap-2 h-12">
                                            <mat-form-field *ngIf="earningForm.value.transactionType == 2" appearance="outline">
                                                <mat-label class="label-font-size">Earnings Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('eT')" formControlName="earningType">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="earningForm.value.transactionType == 1 || earningForm.value.earningType == 2" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input type="file" #earningFile (change)="uploadFileEarn($event,'earningfile','eT')"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value = null"/>
                                                <input readonly matInput id="earningfile" (change)="uploadFileEarn($event,'earningfile','eT')" formControlName="uploadFile"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" [disabled]="buttonDisabled" matSuffix mat-button
                                                    color="primary" (click)="earningFile.click()">Upload</button>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="earningForm.value.earningType == 3" appearance="outline">
                                                <mat-label class="label-font-size">Earning Attendance Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="earningACode">
                                                    <mat-option *ngFor="let item of code" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                                <button *ngIf="earningForm.value.earningType == 2 || earningForm.value.transactionType == 1" class="p-3 px-1 sm:px-4"
                                                    mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download('New Earnings Upload Template')">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                    <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                                </button>

                                                <button
                                                    *ngIf="(earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1)"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('eT')" matTooltip="Delete">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                </button>

                                                <button
                                                    *ngIf="(earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1) && this.showCancel"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                                </button>

                                                <button
                                                    *ngIf="earningForm.value.earningType == 3 || earningForm.value.earningType == 2 || earningForm.value.transactionType == 1 || earningForm.value.earningType == 1"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.earningForm.value.earningType,'earnings','first','earnType')"  matTooltip="Save"
                                                    [disabled]="buttonDisabled">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'mat_outline:save'"></mat-icon>
                                                </button>

                                            <mat-form-field *ngIf="earningForm.value.transactionType == 1" appearance="outline">
                                                <mat-label class="label-font-size">Employee Name</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="employeeName">
                                                    <mat-option *ngFor="let item of employee" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="earningForm.value.transactionType == 1" class="w-40" appearance="outline">
                                                <mat-label class="label-font-size">Status</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="status">
                                                    <mat-option *ngFor="let item of status" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>
                                        <div class="grid grid-cols-2 p-1 gap-1">
                                            <div *ngIf="earningForm.value.earningType === 2" class="grid grid-cols-2">
                                                <div>
                                                 <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                 <mat-card class="scroll-container mat-elevation-z0">
                                                     <app-upload #earnTable
                                                         [checkbox]="deleteShow"
                                                         [cancel]="hideCancel"
                                                         [viewer]="view"
                                                         [datasource]="EarnTableSource"
                                                         (deleted)="earnTableDelete = $event"
                                                         [del]="earnTableDelete"
                                                         (selected)="checkTableE = $event;checkersEarn('ueT')"
                                                         (selectDel)="delTableE = $event"
                                                         [isLoadDone]="true" [isSaveDone]="true">
                                                     </app-upload>
                                                 </mat-card>
                                                </div>
                                                <div class="border-l-4">
                                                 <br>
                                                 <mat-card *ngIf="this.EarnSource.length > 0" class="scroll-container mat-elevation-z0">
                                                     <app-upload [id]="earnType"
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableEC = $event"
                                                        [datasource]="EarnSource"
                                                        (deleted)="earnDelete = $event"
                                                        (selected)="checkedList = $event;checkersEarn('eT')"
                                                        [del]="earnDelete"
                                                        [isLoadDone]="loading" [isSaveDone]="saving">
                                                     </app-upload>
                                                 </mat-card>
                                                </div>
                                            </div>
                                            <div></div>
                                        </div>
                                    </div>

                                    <!-- ================ Field for AB =================== -->

                                    <!-- <div  *ngIf="earningForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                        <div class="flex flex-wrap gap-2 h-12">

                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size">Earning A-B Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('eTAB')" formControlName="earningABType">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #earningABFile (change)="uploadFileEarn($event,'earningABfile','eTAB')"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value = null"/>
                                                <input readonly matInput id="earningABfile" (change)="uploadFileEarn($event,'earningABfile','eTAB')" formControlName="uploadFile2"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button
                                                    color="primary" [disabled]="buttonDisabled" (click)="earningABFile.click()">Upload</button>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="earningForm.value.earningABType == 3" appearance="outline">
                                                <mat-label class="label-font-size">Earning Adjustment Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="earningAdjCode">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <button *ngIf="earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                </button>

                                            <button *ngIf="earningForm.value.earningABType == 3 || earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('eTAB')" matTooltip="Delete">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>

                                            <button *ngIf="earningForm.value.earningABType == 3 || earningForm.value.earningABType == 1 || earningForm.value.earningABType == 2"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="Save('second')" matTooltip="Save" [disabled]="buttonDisabled">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'mat_outline:save'"></mat-icon>
                                            </button>

                                        </div>

                                        ================ Upload list view for AB ===================

                                        <mat-card *ngIf="this.EarnABSource.length > 0" class="scroll-container mat-elevation-z0">
                                            <app-upload [id]="earnTypeAB"
                                                [datasource]="EarnABSource"
                                                (deleted)="earnDelete2 = $event"
                                                (selected)="checkedListEarnAB = $event;checkersEarn('eTAB')"
                                                [del]="earnDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                            </app-upload>

                                        </mat-card>

                                    </div> -->
                                <!-- </div> -->

                                <div class="mt-5">

                                    <!-- ================ Filter field=================== -->

                                    <div *ngIf="(earningForm.value.transactionType === 2) && earningForm.value.earningType === 2 || earningForm.value.earningType === 3" class="flex flex-wrap place-content-between">

                                        <div class="flex flex-wrap gap-2 ">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Earning </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedList.length === 0" (selectionChange)="checkersEarn('eT')" formControlName="earning">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Earning Attendance Base </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListEarnAB.length == 0" (selectionChange)="checkersEarn('eTAB')" formControlName="attendance">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field> -->
                                        </div>

                                        <div class="flex flex-wrap gap-2">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input formControlName="search" matInput placeholder="Search...">
                                            </mat-form-field>

                                            <button class="mb-5" (click)="search('e')" mat-flat-button [color]="'primary'">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                <span class="hidden sm:inline-block ml-2">Search</span>
                                            </button>

                                            <button class="mb-5" mat-flat-button color="primary">
                                                <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                            </button>
                                        </div>

                                    </div>

                                    <!-- ================ Table List view =================== -->

                                    <div *ngIf="(earningForm.value.earning == 1 || earningForm.value.earning == 2) && earningSource.length > 0 || earningSource.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-earning [id]="earnT"
                                                         [datasource]="earningSource"
                                                         (tablefilter)="nextPage($event,'eT','',false)"
                                                         [totalRows]="totalRows"
                                                         [searchVal]="searchTermE"
                                                         [error]="columnHideE">
                                            </app-earning>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="this.checkTableE.length > 0 && this.checkedList.length === 0 && earningUpload.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-earning [datasource]="earningUpload"
                                                         (tablefilter)="nextPage($event,'ueT','',true)"
                                                         [totalRows]="totalRows"
                                                         [searchVal]="searchTermE"
                                                         [error]="columnHideE">
                                            </app-earning>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="(earningForm.value.attendance == 1 || earningForm.value.attendance == 2) && earningABSource.length > 0">
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-earning [id]="earnT" [datasource]="earningABSource" (tablefilter)="nextPage($event,'eTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                        </mat-card>
                                    </div>

                                    <!-- <div *ngIf="earningForm.value.attendance == 1">
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-earning [id]="earnT" [action]="true" [datasource]="earningABSource" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                        </mat-card>
                                    </div> -->

                                    <div *ngIf="earningForm.value.transactionType == 1 && earningESource.length > 0">
                                        <mat-card  class="scroll-container h-80 mat-elevation-z0">
                                            <app-earning [id]="earnT" [datasource]="earningESource" (tablefilter)="nextPage($event,'eE','',false)" [totalRows]="totalRows" [searchVal]="searchTermE" [error]="columnHideE"></app-earning>
                                        </mat-card>
                                    </div>

                                    <!-- <mat-tab-group>
                                        <mat-tab label="Earning Type">

                                            <div class="flex flex-wrap gap-2 place-content-end p-2">

                                                <button mat-flat-button color="primary" class="mt-[3px] text-md">
                                                    <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:download"></mat-icon>Export
                                                </button>

                                                <mat-form-field class="text-md h-5" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input matInput placeholder="Search">
                                                </mat-form-field>

                                                <button class="mt-[3px]" mat-flat-button [color]="'primary'">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                    <span class="hidden sm:inline-block ml-2">Search</span>
                                                </button>

                                            </div>

                                            <mat-card class="scroll-container h-100 mat-elevation-z0">
                                                <app-earnings [datasource]="earningSource"></app-earnings>
                                            </mat-card>

                                            <div class="flex flex-wrap place-content-center">
                                                <button class="learn-more">
                                                    <span class="circle" aria-hidden="true">
                                                    <span class="icon arrow">
                                                    </span>
                                                    </span>
                                                </button>

                                                <button class="learn-more2">
                                                  <span class="circle2" aria-hidden="true">
                                                  <span class="icon2 arrow2"></span>
                                                  </span>
                                                </button>
                                            </div>


                                        </mat-tab>
                                        <mat-tab label="Attendance Base">

                                            <div class="flex flex-wrap gap-2 place-content-end p-2">

                                                <button mat-flat-button color="primary" class="mt-[3px] text-md">
                                                    <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:download"></mat-icon>Export
                                                </button>

                                                <mat-form-field class="text-md h-5" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input matInput placeholder="Search">
                                                </mat-form-field>

                                                <button class="mt-[3px]" mat-flat-button [color]="'primary'">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                    <span class="hidden sm:inline-block ml-2">Search</span>
                                                </button>

                                            </div>

                                            <mat-card class="scroll-container h-100 mat-elevation-z0">
                                                <app-earnings [datasource]="earningSource"></app-earnings>
                                            </mat-card>

                                            <div class="flex flex-wrap place-content-center">
                                                <button class="learn-more">
                                                    <span class="circle" aria-hidden="true">
                                                    <span class="icon arrow">
                                                    </span>
                                                    </span>
                                                </button>

                                                <button class="learn-more2">
                                                  <span class="circle2" aria-hidden="true">
                                                  <span class="icon2 arrow2"></span>
                                                  </span>
                                                </button>
                                            </div>

                                        </mat-tab>
                                    </mat-tab-group> -->
                                </div>

                                <div *ngIf="earningForm.value.earningType == 1" class="relative h-100">
                                    <app-employee-earnings [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchEarnings($event)" [_id]="selectedCategory" [data]="payrollearnForm" [hidebuttons]="true" [parentDetail]="parentDetail"></app-employee-earnings>
                                </div>

                                <br><br><br>

                                <!-- <div class="flex justify-center items-center">
                                    <div class="gird grid-cols-2">
                                        <button class="m-1" mat-flat-button [color]="'primary'" matStepperPrevious>
                                        <mat-icon class="icon-size-5 mt-4" [svgIcon]="'heroicons_outline:arrow-sm-left'"></mat-icon>
                                        <span class="hidden sm:inline-block mr-2">Back</span>
                                    </button>

                                        <button class="m-1" mat-flat-button [color]="'primary'" matStepperNext>
                                        <span class="hidden sm:inline-block ml-2">Continue</span>
                                        <mat-icon class="icon-size-5 mt-4" [svgIcon]="'heroicons_outline:arrow-sm-right'"></mat-icon>
                                        </button>
                                    </div>
                                </div> -->

                            </mat-card>


                        </form>
                    </mat-step>

                    <!-- ===================================================== DEDUCTIONS =========================================================== -->

                    <mat-step *ngIf="!stepperHide" [stepControl]="deductionForm">
                        <form [formGroup]="deductionForm">
                            <ng-template matStepLabel>Deductions</ng-template>

                            <mat-card class="h-full">
                                        <div class="grid grid-cols-10">
                                            <mat-form-field appearance="outline" class="h-12">
                                                <mat-label class="label-font-size">Transaction Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                                    <mat-option *ngFor="let item of transac" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                <div *ngIf="deductionForm.value.transactionType == 1" class="relative h-[50vh]">
                                    <app-datatable
                                                   [tagType]="[{id:[],type:-4}]"
                                                   [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                                   [hideFilter]="true"
                                                   [path]="'deductions-view'"
                                                   [search_btn] = true
                                                   [delete_btn] = true
                                                   [reload_btn] = true
                                                   >
                                    </app-datatable>
                                </div>

                                <!-- ================ For Add Transaction Type =================== -->

                                <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                                    <!-- ================ Field for Deduction =================== -->
                                    <div *ngIf="deductionForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                        <div class="flex flex-wrap gap-2 h-12">
                                            <mat-form-field *ngIf="deductionForm.value.transactionType == 2" appearance="outline">
                                                <mat-label class="label-font-size">Deductions Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('dT')" formControlName="deductionType">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="deductionForm.value.transactionType == 1 || deductionForm.value.deductionType == 2" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #deductionFile (change)="uploadFileDeduc($event,'deductionfile','dT')"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="deductionfile" (change)="uploadFileDeduc($event,'deductionfile','dT')" formControlName="uploadFile"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button
                                                    color="primary" [disabled]="buttonDisabled" (click)="deductionFile.click()">Upload</button>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="deductionForm.value.deductionType == 3" appearance="outline">
                                                <mat-label class="label-font-size">Deduction Attendance Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="deductionACode">
                                                    <mat-option *ngFor="let item of code" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <button *ngIf="deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download" (click)="download('New Deductions Upload Template')">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                    <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                                </button>

                                            <button *ngIf="deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'"  (click)="Delete('dT')" matTooltip="Delete">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>

                                            <button *ngIf="(deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1) && this.showCancel"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                            </button>

                                            <button  *ngIf="deductionForm.value.deductionType == 3 || deductionForm.value.deductionType == 2 || deductionForm.value.transactionType == 1 || deductionForm.value.deductionType == 1"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.deductionForm.value.deductionType,'deduction','first','deductionType')" [disabled]="buttonDisabled" matTooltip="Save">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'mat_outline:save'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                            </button>

                                            <mat-form-field *ngIf="deductionForm.value.transactionType == 1" appearance="outline">
                                                <mat-label class="label-font-size">Employee Name</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="employeeName">
                                                    <mat-option *ngFor="let item of employee" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="deductionForm.value.transactionType == 1" class="w-40" appearance="outline">
                                                <mat-label class="label-font-size">Status</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="status">
                                                    <mat-option *ngFor="let item of status" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>

                                        <div class="grid grid-cols-2 p-1 gap-1">
                                            <div *ngIf="deductionForm.value.deductionType === 2" class="grid grid-cols-2">
                                                <div>
                                                 <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                 <mat-card class="scroll-container mat-elevation-z0">
                                                     <app-upload #deducTable
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableD = $event"
                                                        [datasource]="DeductionTableSource"
                                                        (deleted)="deducTableDelete = $event"
                                                        [del]="deducTableDelete"
                                                        (selected)="checkTableD = $event;checkersDeduc('udT')"
                                                        [isLoadDone]="true" [isSaveDone]="true">
                                                     </app-upload>
                                                 </mat-card>
                                                </div>
                                                <div class="border-l-4">
                                                 <br>
                                                 <mat-card *ngIf="this.DeductionSource.length > 0" class="scroll-container mat-elevation-z0">
                                                    <app-upload [id]="deductionType"
                                                        [checkbox]="deleteShow"
                                                        [cancel]="hideCancel"
                                                        [viewer]="view"
                                                        (selectDel)="delTableDC = $event"
                                                        [datasource]="DeductionSource"
                                                        (deleted)="deductionDelete = $event"
                                                        (selected)="checkedListDeduc = $event;checkersDeduc('dT')"
                                                        [del]="deductionDelete" [isLoadDone]="loading" [isSaveDone]="saving">
                                                    </app-upload>
                                                </mat-card>
                                                </div>
                                            </div>
                                            <div></div>
                                        </div>


                                    </div>

                                    <!-- ================ Field for AB =================== -->

                                    <!-- <div  *ngIf="deductionForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                        <div class="flex flex-wrap gap-2 h-12">

                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size">Deduction A-B Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('dTAB')" formControlName="deductionABType">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2" class="w-32" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #deductionABFile (change)="uploadFileDeduc($event,'deductionABfile','dTAB')"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                    accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="deductionABfile" (change)="uploadFileDeduc($event,'deductionABfile','dTAB')" formControlName="uploadFile2"
                                                    cdkFocusInitial class="z-0"  />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button
                                                    color="primary" (click)="deductionABFile.click()" [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="deductionForm.value.deductionABType == 3" appearance="outline">
                                                <mat-label class="label-font-size">Deduction Adjustment Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="deductionAdjCode">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <button *ngIf="deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                </button>

                                            <button *ngIf="deductionForm.value.deductionABType == 3 || deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('dTAB')" matTooltip="Delete">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                            </button>

                                            <button *ngIf="deductionForm.value.deductionABType == 3 || deductionForm.value.deductionABType == 1 || deductionForm.value.deductionABType == 2"
                                            class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="Save('second')" [disabled]="buttonDisabled" matTooltip="Save">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'mat_outline:save'"></mat-icon>
                                                <span class="hidden sm:inline-block ml-2">Save</span>
                                            </button>

                                            <mat-form-field *ngIf="deductionForm.value.transactionType == 3" appearance="outline">
                                                <mat-label class="label-font-size">Deduction Attendance Base Code</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="deductionCode">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>

                                        ================ Upload list view for AB ===================

                                        <mat-card *ngIf="this.DeductionABSource.length > 0" class="scroll-container mat-elevation-z0">
                                            <app-upload [id]="deductionTypeAB"
                                                [datasource]="DeductionABSource"
                                                (deleted)="deductionDelete2 = $event"
                                                (selected)="checkedListDeducAB = $event;checkersDeduc('dTAB')"
                                                [del]="deductionDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                            </app-upload>
                                        </mat-card>

                                    </div> -->
                                <!-- </div> -->

                                <div class="mt-5">

                                    <!-- ================ Filter field=================== -->

                                    <div *ngIf="(deductionForm.value.transactionType === 2) && deductionForm.value.deductionType === 2 || deductionForm.value.deductionType === 3" class="flex flex-wrap place-content-between">

                                        <div class="flex flex-wrap gap-2 ">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Deduction  </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListDeduc.length == 0" (selectionChange)="checkersDeduc('dT'); switchDeduc('dT')" formControlName="deduction">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Deduction Attendance Base </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListDeducAB.length == 0" (selectionChange)="checkersDeduc('dTAB'); switchDeduc('dTAB')" formControlName="attendance">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field> -->
                                        </div>

                                        <div class="flex flex-wrap gap-2">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input formControlName="search" matInput placeholder="Search...">
                                            </mat-form-field>

                                            <button (click)="search('d')" class="mb-5"  mat-flat-button [color]="'primary'">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                <span class="hidden sm:inline-block ml-2">Search</span>
                                            </button>

                                            <button class="mb-5" mat-flat-button color="primary">
                                                <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                            </button>
                                        </div>

                                    </div>

                                    <!-- ================ Table List view =================== -->

                                    <div *ngIf="(deductionForm.value.deduction == 1 || deductionForm.value.deduction == 2) && deductionSource.length > 0 || deductionSource.length > 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-deduction [id]="earnT" [datasource]="deductionSource" (tablefilter)="nextPage($event,'dT','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="this.checkTableD.length > 0 && this.checkedListDeduc.length === 0">
                                        <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-deduction [datasource]="deductionUpload" (tablefilter)="nextPage($event,'udT','',true)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="(deductionForm.value.attendance == 1 || deductionForm.value.attendance == 2) && deductionABSource.length > 0">
                                        <mat-card class="scroll-container h-80 mat-elevation-z0">
                                            <app-deduction [id]="earnT" [datasource]="deductionABSource" (tablefilter)="nextPage($event,'dTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                        </mat-card>
                                    </div>

                                    <div *ngIf="deductionForm.value.transactionType == 1 && deductionESource.length > 0">
                                        <mat-card  class="scroll-container h-80 mat-elevation-z0">
                                            <app-deduction [id]="earnT" [datasource]="deductionESource" (tablefilter)="nextPage($event,'dE','',false)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideD"></app-deduction>
                                        </mat-card>
                                    </div>

                                </div>

                                <br><br><br>

                                <div *ngIf="deductionForm.value.deductionType == 1" class="relative h-100">
                                    <app-payroll-deduction [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchDeduction($event)" [_id]="selectedCategory" [data]="payrolldeducForm" [hidebuttons]="true" [parentDetail]="parentDetail"></app-payroll-deduction>
                                </div>

                                <!-- <div class="flex justify-center items-center">
                                    <div class="gird grid-cols-2">
                                        <button class="m-1" mat-flat-button [color]="'primary'" matStepperPrevious>
                                        <mat-icon class="icon-size-5 mt-4" [svgIcon]="'heroicons_outline:arrow-sm-left'"></mat-icon>
                                        <span class="hidden sm:inline-block mr-2">Back</span>
                                    </button>

                                        <button class="m-1" mat-flat-button [color]="'primary'" matStepperNext>
                                        <span class="hidden sm:inline-block ml-2">Continue</span>
                                        <mat-icon class="icon-size-5 mt-4" [svgIcon]="'heroicons_outline:arrow-sm-right'"></mat-icon>
                                        </button>
                                    </div>
                                </div> -->

                            </mat-card>


                        </form>
                    </mat-step>

                    <!-- ===================================================== LOANS =========================================================== -->

                    <mat-step *ngIf="!stepperHide" [stepControl]="loanForm">
                        <form [formGroup]="loanForm">
                            <ng-template matStepLabel>Loans</ng-template>
                            <mat-card class="h-full">

                                        <div class="grid grid-cols-10">
                                            <mat-form-field appearance="outline" class="h-12">
                                                <mat-label class="label-font-size">Transaction Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetHeader('e')" formControlName="transactionType">
                                                    <mat-option *ngFor="let item of transac" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                <div *ngIf="loanForm.value.transactionType == 1" class="relative h-[50vh]">
                                    <app-datatable
                                                   [tagType]="[{id:[],type:-4}]"
                                                   [hideDropdown]="['typeId', 'recurringStart', 'recurringEnd']"
                                                   [search_btn] = true
                                                   [delete_btn] = true
                                                   [relaod_btn] = true
                                                   [hideFilter]="true"
                                                   [path]="'loans-view'">
                                    </app-datatable>
                                </div>

                                 <!-- ============== For Loan Edit Transaction Type ============= -->



                                     <!-- ================ For Add Transaction Type =================== -->

                                     <!-- <div class="grid grid-cols-2 p-1 gap-1"> -->
                                        <!-- ================ Field for Loan =================== -->
                                        <div *ngIf="loanForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                            <div class="flex flex-wrap gap-2 h-12">
                                                <mat-form-field *ngIf="loanForm.value.transactionType == 2" appearance="outline">
                                                    <mat-label class="label-font-size">Loan Type</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select (selectionChange)="resetType('lT')" formControlName="loanType">
                                                        <mat-option *ngFor="let item of earn" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <mat-form-field  *ngIf="loanForm.value.loanType == 2" class="w-32" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input multiple type="file" #loanfile (change)="uploadFileLoan($event,'loanFile','lT')"
                                                        class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                        accept=".xlsx" (click)="$event.target.value=null"/>
                                                    <input readonly matInput id="loanFile" formControlName="uploadFile"
                                                        cdkFocusInitial class="z-0" (change)="uploadFileLoan($event,'loanFile','lT')" />
                                                    <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:upload"></mat-icon>
                                                    <button class="upload" matSuffix mat-button
                                                        color="primary" (click)="loanfile.click()" [disabled]="buttonDisabled">Upload</button>
                                                </mat-form-field>

                                                <mat-form-field *ngIf="loanForm.value.loanType == 3" appearance="outline">
                                                    <mat-label class="label-font-size">Loan Attendance Code</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select formControlName="loanACode">
                                                        <mat-option *ngFor="let item of code" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <button *ngIf="loanForm.value.loanType == 2 || loanForm.value.transactionType == 1"
                                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="download('New Loans Upload Template')">
                                                        <mat-icon class="icon-size-5 mt-5"
                                                            [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                        <!-- <span class="hidden sm:inline-block ml-2">Download</span> -->
                                                    </button>

                                                <button *ngIf="loanForm.value.loanType == 3 || loanForm.value.loanType == 2 || loanForm.value.transactionType == 1"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'"  (click)="Delete('lT')">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                </button>

                                                <button
                                                    *ngIf="(loanForm.value.loanType == 3 || loanForm.value.loanType == 2 || loanForm.value.transactionType == 1) && this.showCancel"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                                </button>

                                                <button  *ngIf="loanForm.value.loanType == 3 || loanForm.value.loanType == 2 || loanForm.value.transactionType == 1 || loanForm.value.loanType == 1"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="submit(this.loanForm.value.loanType,'loans','first','loanType')">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'mat_outline:save'"></mat-icon>
                                                    <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                                </button>

                                                <mat-form-field *ngIf="loanForm.value.transactionType == 1" appearance="outline">
                                                    <mat-label class="label-font-size">Employee Name</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select formControlName="employeeName">
                                                        <mat-option *ngFor="let item of employee" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <mat-form-field *ngIf="loanForm.value.transactionType == 1" class="w-40" appearance="outline">
                                                    <mat-label class="label-font-size">Status</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select formControlName="status">
                                                        <mat-option *ngFor="let item of status" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                            </div>

                                            <div class="grid grid-cols-2 p-1 gap-1">
                                                <div *ngIf="loanForm.value.loanType === 2" class="grid grid-cols-2">
                                                    <div>
                                                     <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                     <mat-card class="scroll-container mat-elevation-z0">
                                                         <app-upload #loanTable
                                                            [checkbox]="deleteShow"
                                                            [cancel]="hideCancel"
                                                            [viewer]="view"
                                                            (selectDel)="delTableL = $event"
                                                            [datasource]="LoanTableSource"
                                                            (deleted)="loanTableDelete = $event"
                                                            [del]="loanTableDelete"
                                                            (selected)="checkTableL = $event;checkersLoan('ulT')"
                                                            [isLoadDone]="true" [isSaveDone]="true">
                                                         </app-upload>
                                                     </mat-card>
                                                    </div>
                                                    <div class="border-l-4">
                                                     <br>
                                                     <mat-card *ngIf="this.LoanSource.length > 0" class="scroll-container mat-elevation-z0">
                                                        <app-upload [id]="loanType"
                                                            [checkbox]="deleteShow"
                                                            [cancel]="hideCancel"
                                                            [viewer]="view"
                                                            (selectDel)="delTableDC = $event"
                                                            [datasource]="LoanSource"
                                                            (deleted)="loanDelete = $event"
                                                            (selected)="checkedListLoan = $event;checkersLoan('lT')"
                                                            [del]="loanDelete" [isLoadDone]="loading" [isSaveDone]="saving">
                                                        </app-upload>
                                                    </mat-card>
                                                    </div>
                                                </div>
                                                <div></div>
                                            </div>


                                        </div>

                                        <!-- ================ Field for AB =================== -->

                                        <!-- <div  *ngIf="loanForm.value.transactionType == 2" class="border-2 p-4 rounded-sm">
                                            <div class="flex flex-wrap gap-2 h-12">

                                                <mat-form-field appearance="outline">
                                                    <mat-label class="label-font-size">Loan A-B Type</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select (selectionChange)="resetType('lTAB')" formControlName="loanABType">
                                                        <mat-option *ngFor="let item of earn" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <mat-form-field  *ngIf="loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2" class="w-40" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input multiple type="file" #loanABfile (change)="uploadFileLoan($event,'loanABFile','lTAB')"
                                                        class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0"
                                                        accept=".xlsx" (click)="$event.target.value=null"/>
                                                    <input readonly matInput id="loanABFile" formControlName="uploadFile2"
                                                        cdkFocusInitial class="z-0" (change)="uploadFileLoan($event,'loanABFile','lTAB')" />
                                                    <mat-icon class="icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:upload"></mat-icon>
                                                    <button class="upload" matSuffix mat-button
                                                        color="primary" (click)="loanABfile.click()" [disabled]="buttonDisabled">Upload</button>
                                                </mat-form-field>

                                                <mat-form-field *ngIf="loanForm.value.loanABType == 3" appearance="outline">
                                                    <mat-label class="label-font-size">Loan Adjustment Code</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select formControlName="loanAdjCode">
                                                        <mat-option *ngFor="let item of code" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <button *ngIf="loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                                        class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" matTooltip="Download">
                                                        <mat-icon class="icon-size-5 mt-5"
                                                            [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                    </button>

                                                <button *ngIf="loanForm.value.loanABType == 3 || loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('lTAB')" matTooltip="Delete">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                </button>

                                                <button *ngIf="loanForm.value.loanABType == 3 || loanForm.value.loanABType == 1 || loanForm.value.loanABType == 2"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" [disabled]="buttonDisabled" (click)="Save('second')" matTooltip="Save">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'mat_outline:save'"></mat-icon>
                                                </button>

                                                <mat-form-field *ngIf="loanForm.value.transactionType == 3" appearance="outline">
                                                    <mat-label class="label-font-size">Loan Attendance Base Code</mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select formControlName="loanCode">
                                                        <mat-option *ngFor="let item of earn" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                            </div>

                                            ================ Upload list view for AB ===================

                                            <mat-card *ngIf="this.LoanABSource.length > 0" class="scroll-container mat-elevation-z0">
                                                <app-upload [id]="loanTypeAB"
                                                    [datasource]="LoanABSource"
                                                    (deleted)="loanABDelete2 = $event"
                                                    (selected)="checkedListLoanAB = $event;checkersLoan('lTAB')"
                                                    [del]="loanABDelete2" [isLoadDone]="loading" [isSaveDone]="saving">
                                                </app-upload>
                                            </mat-card>

                                        </div> -->
                                    <!-- </div> -->

                                    <div class="mt-5">

                                        <!-- ================ Filter field=================== -->

                                        <div *ngIf="(loanForm.value.transactionType === 2) && loanForm.value.loanType === 2 || loanForm.value.loanType === 3" class="flex flex-wrap place-content-between">

                                            <div class="flex flex-wrap gap-2 ">
                                                <mat-form-field class="text-md h-10" appearance="outline">
                                                    <mat-label class="label-font-size"> Loans  </mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select [disabled]="this.checkedListLoan.length == 0" (selectionChange)="checkersLoan('lT');switchLoan('lT')" formControlName="loan">
                                                        <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <!-- <mat-form-field class="text-md h-10" appearance="outline">
                                                    <mat-label class="label-font-size"> Loans Attendance Base </mat-label>
                                                    <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                        svgIcon="mat_outline:info"></mat-icon>
                                                    <mat-select [disabled]="this.checkedListLoanAB.length == 0" (selectionChange)="checkersLoan('lTAB');switchLoan('lTAB')" formControlName="attendance">
                                                        <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                            {{item.description}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field> -->
                                            </div>

                                            <div class="flex flex-wrap gap-2">
                                                <mat-form-field class="text-md h-10" appearance="outline">
                                                    <mat-label class="label-font-size"></mat-label>
                                                    <input formControlName="search" matInput placeholder="Search...">
                                                </mat-form-field>

                                                <button (click)="search('l')" class="mb-5"  mat-flat-button [color]="'primary'">
                                                    <mat-icon class="icon-size-5 mt-5"
                                                        [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                    <span class="hidden sm:inline-block ml-2">Search</span>
                                                </button>

                                                <button class="mb-5" mat-flat-button color="primary">
                                                    <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                                </button>
                                            </div>

                                        </div>

                                        <!-- ================ Table List view =================== -->
                                        <div *ngIf="(loanForm.value.loan == 1 || loanForm.value.loan == 2) && loanSource.length > 0 || loanSource.length > 0">
                                            <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                            <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-loan [id]="earnT" [datasource]="loanSource" (tablefilter)="nextPage($event,'lT','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                            </mat-card>
                                        </div>

                                        <div *ngIf="this.checkTableL.length > 0 && this.checkedListLoan.length === 0">
                                            <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                            <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-loan [datasource]="loanUpload" (tablefilter)="nextPage($event,'ulT','',true)" [totalRows]="totalRows" [searchVal]="searchTermD" [error]="columnHideL"></app-loan>
                                            </mat-card>
                                        </div>

                                        <div *ngIf="(loanForm.value.attendance == 1 || loanForm.value.attendance == 2) && loanABSource.length > 0">
                                            <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-loan [id]="earnT" [datasource]="loanABSource" (tablefilter)="nextPage($event,'lTAB','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                            </mat-card>
                                        </div>

                                        <div *ngIf="loanForm.value.transactionType == 1 && loanESource.length > 0">
                                            <mat-card class="scroll-container h-80 mat-elevation-z0">
                                                <app-loan [id]="earnT" [datasource]="loanESource" (tablefilter)="nextPage($event,'lE','',false)" [totalRows]="totalRows" [searchVal]="searchTermL" [error]="columnHideL"></app-loan>
                                            </mat-card>
                                        </div>

                                    </div>

                                    <div *ngIf="loanForm.value.loanType == 1" class="relative h-100">
                                        <app-payroll-loans [shared]="true" [frequency]="detailForm.value.cutoffID" [payrollType]="detailForm.value.payoutTypeID" (formChanged)="PatchLoans($event)" [_id]="selectedCategory" [data]="payrollloansForm" [hidebuttons]="true" [parentDetail]="parentDetail" ></app-payroll-loans>
                                    </div>
                                    <br><br><br>

                            </mat-card>
                        </form>
                    </mat-step>

                    <!-- ===================================================== GOV'T CONTRIBUTION =========================================================== -->

                    <mat-step *ngIf="!stepperHide" [stepControl]="contributionForm">
                        <form [formGroup]="contributionForm">
                            <ng-template matStepLabel>Gov't Contribution</ng-template>
                            <mat-card>

                                <!-- ============== UPLOAD FILE ============= -->

                                <div>
                                    <div>
                                        <div class="flex flex-wrap gap-2 h-12">

                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size">Transaction Type</mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select (selectionChange)="resetType('gc')" formControlName="transactionType">
                                                    <mat-option *ngFor="let item of earn" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <mat-form-field *ngIf="contributionForm.value.transactionType == 2" class="w-40" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input multiple type="file" #govtfile (change)="uploadFilegov($event,'govtFile','ugT')"
                                                    class="absolute top-1 z-10 h-full w-full cursor-pointer opacity-0" accept=".xlsx" (click)="$event.target.value=null"/>
                                                <input readonly matInput id="govtFile" formControlName="uploadFile" cdkFocusInitial class="z-0"
                                                    (change)="uploadFilegov($event,'govtFile','ugT')" />
                                                <mat-icon class="icon-size-5 : mr-2" matPrefix svgIcon="mat_outline:upload"></mat-icon>
                                                <button class="upload" matSuffix mat-button color="primary" (click)="govtfile.click()" [disabled]="buttonDisabled">Upload</button>
                                            </mat-form-field>

                                            <div class="mr-2 ml-2 gap-5 mt-3" *ngIf="contributionForm.value.transactionType == 3" style="display: flex; flex-direction: row;">
                                                <mat-checkbox [color]="'primary'" > SSS </mat-checkbox>
                                                <mat-checkbox [color]="'primary'" > PHIC </mat-checkbox>
                                                <mat-checkbox [color]="'primary'" > HDMF </mat-checkbox>
                                                <mat-checkbox [color]="'primary'" > TAX </mat-checkbox>
                                            </div>


                                            <div class="flex flex-wrap gap-2 ml-2">
                                                <button *ngIf="contributionForm.value.transactionType == 2" class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="download('New GovCon Upload')">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:download'"></mat-icon>
                                                </button>

                                                <button *ngIf="contributionForm.value.transactionType === 2"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Delete('gc')">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                </button>

                                                <button
                                                    *ngIf="contributionForm.value.transactionType === 2 && this.showCancel"
                                                    class="p-3 px-1 sm:px-4" mat-flat-button [color]="'warn'" (click)="Cancel()" matTooltip="Cancel">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_solid:x-circle'"></mat-icon>
                                                </button>

                                                <button *ngIf="contributionForm.value.transactionType == 2 || contributionForm.value.transactionType == 3"
                                                class="p-3 px-1 sm:px-4" mat-flat-button [color]="'primary'" (click)="submit(this.contributionForm.value.transactionType,'govcon','first','govType')" [disabled]="buttonDisabled">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'mat_outline:save'"></mat-icon>
                                                    <!-- <span class="hidden sm:inline-block ml-2">Save</span> -->
                                                </button>
                                            </div>



                                        </div>


                                        <!-- ================ Upload list view =================== -->

                                        <div *ngIf="contributionForm.value.transactionType === 2" class="grid grid-cols-2 gap-2">
                                            <div class="grid grid-cols-2 gap-2">
                                                <div>
                                                    <p class="text-md pl-3"><strong>Saved files</strong></p>
                                                    <mat-card class="scroll-container mat-elevation-z0">
                                                        <app-upload #govtTable
                                                                [checkbox]="deleteShow"
                                                                [cancel]="hideCancel"
                                                                [viewer]="view"
                                                                (selectDel)="delTableG = $event"
                                                                [datasource]="GovTableSource"
                                                                (deleted)="govTableDelete = $event"
                                                                [del]="govTableDelete"
                                                                (selected)="checkTableG = $event;checkersGov('ugT')"
                                                                [isLoadDone]="true"
                                                                [isSaveDone]="true">
                                                        </app-upload>
                                                    </mat-card>
                                                </div>
                                                <div class="border-l-4">
                                                    <br>
                                                    <mat-card *ngIf="this.GovtSource.length > 0" class="scroll-container mat-elevation-z0">
                                                        <app-upload [id]="'govtfile'"
                                                                [checkbox]="deleteShow"
                                                                [cancel]="hideCancel"
                                                                [viewer]="view"
                                                                (selectDel)="delTableGC = $event"
                                                                [datasource]="GovtSource"
                                                                (deleted)="govtDelete = $event"
                                                                (selected)="checkedListGov = $event; checkersGov('gT')"
                                                                [del]="govtDelete"
                                                                [isLoadDone]="loading"
                                                                [isSaveDone]="saving">
                                                        </app-upload>
                                                    </mat-card>
                                                </div>
                                            </div>
                                            <div></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ================ Filter field =================== -->
                                <div class="mt-5" *ngIf="contributionForm.value.transactionType === 2">
                                    <div class="flex flex-wrap place-content-between">

                                        <div class="flex flex-wrap gap-2 ">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"> Gov't Contribution  </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select [disabled]="this.checkedListGov.length == 0" (selectionChange)="checkersGov();switchGov()" formControlName="govcon">
                                                    <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>

                                        <div class="flex flex-wrap gap-2">
                                            <mat-form-field class="text-md h-10" appearance="outline">
                                                <mat-label class="label-font-size"></mat-label>
                                                <input formControlName="search" matInput placeholder="Search...">
                                            </mat-form-field>

                                            <button (click)="search('gc')" class="mb-5" mat-flat-button [color]="'primary'">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                <span class="hidden sm:inline-block ml-2">Search</span>
                                            </button>

                                            <button class="mb-5" mat-flat-button color="primary">
                                                <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>Export
                                            </button>
                                        </div>

                                    </div>
                                </div>

                                 <!-- ================ Table List view =================== -->
                                 <div *ngIf="(contributionForm.value.govcon == 1 || contributionForm.value.govcon == 2)  && govconSource.length > 0 || govconSource.length > 0">
                                    <p class="text-lg pl-3 pt-5"><strong>Current Upload File View</strong></p>
                                    <mat-card class="scroll-container h-80 mat-elevation-z0">
                                        <app-govcon [id]="earnT"
                                                    [action]="false"
                                                    [datasource]="govconSource"
                                                    (tablefilter)="nextPage($event,'gc','',false)"
                                                    [totalRows]="totalRows"
                                                    [searchVal]="searchTermGc"
                                                    [error]="columnHideG">
                                        </app-govcon>
                                    </mat-card>
                                </div>

                                <div *ngIf="this.checkTableG.length > 0 && this.checkedListGov.length === 0">
                                    <p class="text-lg pl-3 pt-5"><strong>Uploaded File View</strong></p>
                                    <mat-card class="scroll-container h-80 mat-elevation-z0">
                                        <app-govcon [datasource]="govtUpload" (tablefilter)="nextPage($event,'ugT','',true)" [totalRows]="totalRows" [searchVal]="searchTermGc" [error]="columnHideG"></app-govcon>
                                    </mat-card>
                                </div>

                                <br><br><br>

                            </mat-card>
                        </form>
                    </mat-step>

                    <!-- ===================================================== GENERATE PAYROLL =========================================================== -->

                    <mat-step [stepControl]="generateForm">
                        <form [formGroup]="generateForm">
                            <ng-template matStepLabel>Generate Payroll</ng-template>
                            <mat-card>
                                <div *ngIf="bank">

                                    <!-- ============== UPLOAD FILE ============= -->

                                        <div class="border-2 p-4 rounded-sm">

                                            <div class="flex flex-wrap gap-2 place-content-between p-2">

                                                <div class="flex flex-wrap gap-2">

                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">Pay Register</mat-label>
                                                        <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                            svgIcon="mat_outline:info"></mat-icon>
                                                        <mat-select formControlName="payRegister">
                                                            <mat-option *ngFor="let item of tk1" [value]="item.id">
                                                                {{item.description}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>

                                                    <button mat-flat-button color="primary" class="mt-[3px] text-md">
                                                        <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:download" matTooltip="Download"></mat-icon>
                                                    </button>

                                                    <button class="mt-[3px] text-md" mat-flat-button [color]="'primary'" (click)="generatePayroll()">Calculate Payroll</button>

                                                    <button mat-flat-button color="primary" class="mt-[3px] text-md" (click)="exportall()">
                                                        <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:download"></mat-icon>Payroll Register
                                                    </button>

                                                </div>

                                                <div class="flex flex-wrap gap-2">

                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">Payslip</mat-label>
                                                        <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                            svgIcon="mat_outline:info"></mat-icon>
                                                        <mat-select formControlName="payslip">
                                                            <mat-option *ngFor="let item of payslip" [value]="item.id">
                                                                {{item.description}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>

                                                    <button (click)="proceed()" mat-flat-button color="primary" class="mt-[3px] text-md">
                                                        <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:double_arrow" matTooltip="Proceed"></mat-icon>
                                                    </button>

                                                    <button (click)="onBank()" class="mt-[3px] text-md" mat-flat-button [color]="'primary'">Bank File</button>

                                                    <button (click)="openModalApprove()" class="mt-[3px] text-md" mat-flat-button [color]="'primary'">Lock Payroll</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!------------------------- Tabs sector ----------------------------->

                                    <div class="mt-5 h-full">

                                        <div class="flex flex-wrap gap-1 place-content-between">
                                            <div class="flex flex-wrap gap-1 ">
                                                <!-- <div (click)="changeTab('pei')"
                                                    class="relative flex self-start pt-2 pl-2 pb-1 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isPeIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2">
                                                        </div>
                                                    </div>
                                                </div> -->

                                                <div (click)="changeTab('woi')"
                                                    class="relative flex self-start pt-2 pl-2 pb-1 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isWoIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject1)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('pai')"
                                                    class="relative self-start pt-2 pb-1 pl-2  pr-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isPaIfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject2)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('s')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isSfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject3)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('l')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isLfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject4)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('O')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isOtherfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject5)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('E')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isEfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject6)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>
                                                <div (click)="changeTab('A')"
                                                    class="relative flex self-start pt-2 pb-1 pl-2 cursor-pointer overflow-hidden rounded-t-xl border border-b-0 {{isAdfocus}}"
                                                    matRipple *transloco="let t" [matMenuTriggerFor]="projectsMenu">
                                                    <div class="flex items-center">
                                                        <div class="overflow-hidden">
                                                            <div class="font-medium leading-6 truncate">{{t(selectedProject7)}}</div>
                                                        </div>
                                                        <div class="flex items-center justify-center pl-2"></div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="flex flex-wrap gap-1">
                                                <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">Employee Code</mat-label>
                                                        <input matInput [placeholder]="'Employee Code'" formControlName="employeeCode">
                                                    </mat-form-field>
                                                </div>

                                                <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">First Name</mat-label>
                                                        <input matInput [placeholder]="'First Name'" formControlName="firstName">
                                                    </mat-form-field>
                                                </div>

                                                <div class="flex flex-wrap gap-1">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">Last Name</mat-label>
                                                        <input matInput [placeholder]="'Last Name'" formControlName="lastName">
                                                    </mat-form-field>
                                                </div>

                                                <div class="mb-3">
                                                    <mat-form-field class="text-md h-5" appearance="outline">
                                                        <mat-label class="label-font-size">Payslip Status</mat-label>
                                                        <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                            svgIcon="mat_outline:info"></mat-icon>
                                                        <mat-select formControlName="payslipStatus">
                                                            <mat-option *ngFor="let item of stat" [value]="item.id">
                                                                {{item.description}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>

                                                <button class="mt-[3px]" mat-flat-button [color]="'primary'" (click)="searchParams(this.generateForm,'gp')" matTooltip="Search">
                                                    <mat-icon class="icon-size-5 mt-5" [svgIcon]="'heroicons_outline:search'" ></mat-icon>
                                                </button>

                                                <button mat-flat-button color="primary" class="mt-[3px] text-md" matTooltip="Export">
                                                    <mat-icon class="icon-size-5 mt-5" matSuffix svgIcon="mat_outline:file_upload"></mat-icon>
                                                </button>

                                                <button (click)="ytd_2316()" *ngIf="detailForm.value.payoutTypeID === 12720" mat-flat-button color="primary" class="mt-[3px] text-md" matTooltip="Export"> 2316 and YTD
                                                </button>

                                            </div>
                                        </div>


                                            <!-- Main -->
                                            <div class=" w-full flex-auto border-t -mt-px pt-4 sm:pt-6" *transloco="let t">
                                                <div class="w-full">
                                                    <!-- Tabs -->

                                                <!-- Summary -->
                                                    <!-- <div [hidden]="!isPeI" class="bg-card shadow rounded-2xl">

                                                        <mat-card class="scroll-container mat-elevation-z0">
                                                        </mat-card>

                                                    </div> -->

                                                <!-- Payreg -->

                                                    <div class="bg-card shadow rounded-2xl h-full"  [hidden]="!isWoI">
                                                            <app-generate *ngIf="payregSource?.length > 0"
                                                                          (selected)="payRegCheck = $event"
                                                                          (excludedList)="payRegExclude = $event"
                                                                          [checkbox]="true"
                                                                          [datasource]="payregSource"
                                                                          (tablefilter)="nextPage($event,'gp','payreg','')"
                                                                          [totalRows]="totalRows1"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="payregColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true"
                                                                          (passCheck)="allSelected = $event">
                                                            </app-generate>

                                                    </div>

                                                <!-- Misc -->
                                                    <div class="bg-card shadow rounded-2xl " [hidden]="!isPaI">

                                                            <app-generate *ngIf="miscSource?.length > 0"
                                                                          [datasource]="miscSource"
                                                                          (tablefilter)="nextPage($event,'gp','misc','')"
                                                                          [totalRows]="totalRows2"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="miscColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>

                                                    </div>
                                                <!-- OtSheet -->
                                                    <div class="bg-card shadow rounded-2xl " [hidden]="!isS">

                                                            <app-generate *ngIf="otSource?.length > 0"
                                                                          [datasource]="otSource"
                                                                          (tablefilter)="nextPage($event,'gp','ot','')"
                                                                          [totalRows]="totalRows3"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="otColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>

                                                    </div>
                                                <!-- Tax -->
                                                    <div class="bg-card shadow rounded-2xl" [hidden]="!isL">

                                                            <app-generate *ngIf="taxSource?.length > 0"
                                                                          [datasource]="taxSource"
                                                                          (tablefilter)="nextPage($event,'gp','tax','')"
                                                                          [totalRows]="totalRows4"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="taxColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>

                                                    </div>
                                                <!-- NTax -->
                                                    <div class="bg-card shadow rounded-2xl" [hidden]="!isOther">

                                                            <app-generate *ngIf="ntaxSource?.length > 0"
                                                                          [datasource]="ntaxSource"
                                                                          (tablefilter)="nextPage($event,'gp','ntax','')"
                                                                          [totalRows]="totalRows5"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="ntaxColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>

                                                    </div>
                                                <!-- Loan -->
                                                    <div class="bg-card shadow rounded-2xl" [hidden]="!isException">

                                                            <app-generate *ngIf="loanGPSource?.length > 0"
                                                                          [datasource]="loanGPSource"
                                                                          (tablefilter)="nextPage($event,'gp','loan','')"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [totalRows]="totalRows6"
                                                                          [cols]="loanColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>

                                                    </div>
                                                <!-- Deductions -->
                                                    <div class="bg-card shadow rounded-2xl" [hidden]="!isAdmin">

                                                            <app-generate *ngIf="dedSource?.length > 0"
                                                                          [datasource]="dedSource"
                                                                          (tablefilter)="nextPage($event,'gp','ded','')"
                                                                          [totalRows]="totalRows7"
                                                                          [searchVal]="this.generateForm.value.firstName && this.generateForm.value.lastName"
                                                                          [cols]="dedColumns"
                                                                          [details]="false"
                                                                          [hideCols]="true">
                                                            </app-generate>
                                                    </div>
                                                </div>
                                            </div>
                                    </div>
                                </div>
                                <div *ngIf="!bank">
                                    <mat-card-title>
                                        <app-card-title title="Bank File" [sub]="false" [back]="false" [return]="true" (returnTap)="onGP()"></app-card-title>
                                    </mat-card-title>
                                    <div class="flex flex-wrap gap-2">
                                        <app-payroll-hierarchy [showTag]="false" [notincludetag]="[-3, 132,-4]" [defaultTag]="defaultTag" [multiple]="true" [resultHierarchy]="resultHierarchy" [payrollID]="payrollId" [all]="true"></app-payroll-hierarchy>
                                        <!-- <div class="flex flex-wrap gap-2"> -->
                                            <mat-form-field appearance="outline">
                                                <mat-label class="label-font-size"> With Bank Account </mat-label>
                                                <mat-icon class="uploadbutton icon-size-5 : mr-2" matPrefix
                                                    svgIcon="mat_outline:info"></mat-icon>
                                                <mat-select formControlName="bankOption">
                                                    <mat-option *ngFor="let item of ba" [value]="item.id">
                                                        {{item.description}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                            <button class="mb-5"  mat-flat-button [color]="'primary'" matTooltip="Search" (click)="loadBankTable(true)">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:search'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Search</span> -->
                                            </button>

                                            <button class="mb-5"  mat-flat-button [color]="'primary'" matTooltip="Export">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'mat_outline:file_upload'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Export</span> -->
                                            </button>

                                            <button class="mb-5"  mat-flat-button [color]="'primary'" (click)="dialogModal()" matTooltip="Generate">
                                                <mat-icon class="icon-size-5 mt-5"
                                                    [svgIcon]="'heroicons_outline:refresh'"></mat-icon>
                                                <!-- <span class="hidden sm:inline-block ml-2">Generate</span> -->
                                            </button>
                                        <!-- </div> -->

                                    </div>

                                    <div class="bg-card shadow rounded-2xl h-full">
                                        <app-generate *ngIf="bankSource.length > 0" [datasource]="bankSource" (tablefilter)="nextPage($event,'bank','','')" [totalRows]="totalRowsBank" [cols]="bankColumns" [details]="false" [hideCols]="true"></app-generate>
                                    </div>

                                    <!-- <div class="flex justify-center items-center">
                                        <button  mat-flat-button (click)="onGP()" [color]="'primary'" >Previous</button>
                                    </div> -->

                                </div>
                            </mat-card>
                        </form>
                    </mat-step>
